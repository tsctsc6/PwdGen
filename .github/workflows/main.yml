name: Publish .NET 8 Windows Application

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup .NET 8
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '8.0.x'

    - name: Publish .NET application
      run: dotnet publish ./PwdGen.Desktop/PwdGen.Desktop.csproj --configuration Release --runtime win-x64 --output ${{ github.workspace }}/temp_release --no-self-contained -p:PublishSingleFile=true -p:PublishReadyToRun=true

    - name: Create .NET Release ZIP
      run: |
        zip -r dotnet_release.zip ${{ github.workspace }}/temp_release/*
        mv dotnet_release.zip ${{ github.workspace }}/release/

    - name: Calculate .NET ZIP SHA256
      id: dotnet_sha256
      run: |
        sha256sum ${{ github.workspace }}/release/dotnet_release.zip | awk '{ print $1 }' > ${{ github.workspace }}/release/dotnet_sha256.txt

    - name: Create GitHub Release
      id: create_release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.1.0
        release_name: Release v1.1.0
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

    - name: Upload Release Assets
      uses: softprops/action-gh-release@v1
      with:
        upload_assets: |
          ${{ github.workspace }}/release/dotnet_release.zip
          ${{ github.workspace }}/release/dotnet_sha256.txt
        tag_name: v1.1.0
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
